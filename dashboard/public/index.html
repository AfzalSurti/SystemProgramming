<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Monitor Dashboard</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="wrap">
      <header class="header">
        <div class="brand">
          <div class="title">Log Monitor Dashboard</div>
          <div class="subtitle">
            Live metrics from <span class="mono">stats.json</span> and grouped incidents from <span class="mono">incidents.json</span>.
          </div>
        </div>
        <div class="actions">
          <div class="pill">
            <span class="dot" id="liveDot"></span>
            <span id="liveText">Live</span>
          </div>
          <button class="btn" id="refreshBtn">Refresh</button>
        </div>
      </header>

      <section class="stats">
        <div class="card">
          <div class="k">Total Requests</div>
          <div class="v" id="statTotal">-</div>
          <div class="muted" id="statTime">Last updated (IST): -</div>
        </div>
        <div class="card">
          <div class="k">404 Errors</div>
          <div class="v" id="stat404">-</div>
          <div class="muted">Usually low severity unless repeated on important routes.</div>
        </div>
        <div class="card">
          <div class="k">500 Errors</div>
          <div class="v" id="stat500">-</div>
          <div class="muted">High severity. Backend is failing.</div>
        </div>
        <div class="card">
          <div class="k">4xx Errors</div>
          <div class="v" id="stat4xx">-</div>
          <div class="muted">Total client errors.</div>
        </div>
        <div class="card">
          <div class="k">5xx Errors</div>
          <div class="v" id="stat5xx">-</div>
          <div class="muted">Total server errors.</div>
        </div>

        <div class="card">
          <div class="k">Open Incidents</div>
          <div class="v" id="statIncidents">-</div>
          <div class="muted">Total grouped by path + status.</div>
        </div>
        <div class="card">
          <div class="k">Avg Latency (ms)</div>
          <div class="v" id="statAvgLatency">-</div>
          <div class="muted">Average response time across requests.</div>
        </div>
        <div class="card">
          <div class="k">P95 Latency (ms)</div>
          <div class="v" id="statP95Latency">-</div>
          <div class="muted">95% of requests complete under this time.</div>
        </div>
        <div class="card">
          <div class="k">Latency Health</div>
          <div class="v" id="statLatencyHealth">-</div>
          <div class="muted">Heuristic verdict (local, no external model).</div>
        </div>
        <div class="card">
          <div class="k">Active Alerts</div>
          <div class="v" id="statAlerts">-</div>
          <div class="muted">From <span class="mono">alerts.jsonl</span>.</div>
        </div>
        <div class="card">
          <div class="k">Last Email</div>
          <div class="v" id="statEmail">-</div>
          <div class="muted" id="statEmailMeta">No emails sent yet.</div>
        </div>
      </section>

      <section class="content">
        <div class="card tableCard">
          <div class="toolbar">
            <div>
              <div class="sectionTitle">Incidents</div>
              <div class="muted">Click a row to see details</div>
            </div>
            <div class="leftTools">
              <input class="input" id="q" placeholder="Search: /login, 500, /afzal..." />
              <select class="select" id="filter">
                <option value="all">All</option>
                <option value="500">Only 500</option>
                <option value="404">Only 404</option>
              </select>
              <select class="select" id="sort">
                <option value="count">Sort: Count</option>
                <option value="status">Sort: Status</option>
                <option value="path">Sort: Path</option>
                <option value="lastSeen">Sort: Last Seen</option>
              </select>
            </div>
          </div>
          <div id="tableWrap"></div>
        </div>

        <div class="card detailCard" id="detailCard">
          <div class="panelTitle">Incident Details</div>
          <div class="muted">Select an incident from the table.</div>
          <div class="sp10"></div>

          <div class="empty" id="detailEmpty">Nothing selected yet.</div>
          <div id="detail" style="display:none;"></div>
        </div>

        <div class="card alertsCard">
          <div class="panelTitle">Alerts</div>
          <div class="muted">Recent alerts generated by the monitor.</div>
          <div class="sp10"></div>
          <div id="alertsWrap" class="empty">No alerts yet.</div>
        </div>
      </section>
    </div>
    <script src="./app.js"></script>
  </body>
</html>
